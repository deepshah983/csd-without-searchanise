---
brand:
    products:
        limit: 48
---
{{inject "brandProductsPerPage" theme_settings.brandpage_products_per_page}}
{{#partial "head"}}
    {{#if pagination.brand.previous}}
        <link rel="prev" href="{{pagination.brand.previous}}">
    {{/if}}
    {{#if pagination.brand.next}}
        <link rel="next" href="{{pagination.brand.next}}">
    {{/if}}
{{/partial}}

{{#partial "customBreadcrumbs"}}
<div class="container">
    {{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
</div>
{{/partial}}

{{#partial "page"}}

{{#comment}}
{{#if brand.image}}
    <div class="brand-image-container">
        {{> components/common/responsive-img
            image=brand.image
            fallback_size=theme_settings.thumb_size
            lazyload='disabled'
        }}
    </div>
{{/if}}
{{/comment}}

{{#unless banners.top}}
<h1 class="default-title">PRE-OWNED {{{brand.name}}} FOR WOMEN</h1>
{{/unless}}

{{{region name="brand_below_header"}}}


<div class="page">
    <div class="page-sidebar-sticky">
        <aside class="page-sidebar" id="faceted-search-container">
            {{> components/brand/sidebar}}
        </aside>
    </div>

    <main class="page-content" id="product-listing-container">
        {{#if brand.search_error }}
            <p>{{lang 'search.errorMessage'}}</p>
        {{else}}
            {{#if brand.products}}
                {{> components/brand/product-listing}}
            {{else}}
                <p>{{lang 'brands.no_products'}}</p>	
                <div class="you-may-also-like" >
                    <h3 class="you-may-also-like-title">You May Also Like</h3>
                    <div class="loaded-products-container productGridFavourite productGrid productGrid--maxCol">
                
                    </div>
                    
                </div>	
                <div class="page-load-status" style="display: none;">
                    <div class="infinite-scroll-request">
                      <img src="https://cdn11.bigcommerce.com/s-bg6cc73hmt/images/stencil/original/image-manager/animation-1721652758711-2-.gif?t=1721653380"> 
                    </div>
                </div>	
                <div class="no-more-status" style="display: none;">
                    <p class="infinite-scroll-last">No more products to load</p>
                </div>
            {{/if}}
            {{{region name="brand_below_content"}}}
        {{/if}}
    </main>
</div>


{{#comment}}
<script src="//www.searchanise.com/widgets/bigcommerce/init.js?api_key=3L7x6q3O0Y"></script> 
<div class="snize" id="snize_results" data-brand-page="true"></div>
{{/comment}}


<script>

function youMayAlsoLike(cursor = null) {
    let graphqlQuery = `
        query CategoryByUrl($cursor: String) {
            site {
                route(path: "/sales/women/new-arrivals/") {
                    node {
                        id
                        ... on Category {
                            name
                            entityId
                            description
                            products(first: 50, after: $cursor, sortBy: NEWEST, hideOutOfStock: true) {
                                pageInfo {
                                    startCursor
                                    endCursor
                                    hasNextPage
                                }
                                edges {
                                    node {
                                        entityId
                                        name
                                        path
                                        defaultImage {
                                            url(width: 1200)
                                        }
                                        customFields {
                                            edges {
                                                node {
                                                    value
                                                    name
                                                    entityId
                                                }
                                            }
                                        }
                                        inventory {
                                            isInStock
                                            hasVariantInventory
                                        }
                                        brand {
                                            name
                                            defaultImage {
                                                url(width: 200)
                                            }
                                        }
                                        prices (includeTax:true){
                                            price {
                                                ...MoneyFields
                                            }
                                            salePrice {
                                                ...MoneyFields
                                            }
                                            retailPrice {
                                                ...MoneyFields
                                            }
                                            basePrice {
                                                ...MoneyFields
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        fragment MoneyFields on Money {
            value
            currencyCode
        }
    `;

    const headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer {{ settings.storefront_api.token }}'
    };

    $.ajax({
        type: 'POST',
        url: '/graphql',
        headers: headers,
        async: false,
        data: JSON.stringify({
            query: graphqlQuery,
            variables: {
                cursor: cursor
            }
        }),
        dataType: 'json',
        success: function(data) {
            if (data.data.site.route.node != null && data.data.site.route.node.products.edges.length > 0) {
                let allData = data.data.site.route.node.products.edges;
                let html = '';
                let currency = getCurrencySymbol(allData[0].node?.prices?.price?.currencyCode)
                let count = 0;

                $.each(allData, function(index, value) {
                    let custFileds = '';
                    $.each(value?.node?.customFields?.edges, function(ind, val) {
                        let name = val.node.name;
                        let values = val.node.value;
                        if (name == "UK" || name == "US" || name == "FR" || name == "IT" || name == "EU/IT") {
                            if (custFileds == "")
                                custFileds = name + ' ' + values;
                            else
                                custFileds = custFileds + ', ' + name + ' ' + values;
                        }
                    });

                    if (value.node.inventory.isInStock) {
                        count++;

                        html += '<div class="product">'
                        html += '<article class="card" data-entity-id="' + value.node.entityId + '" data-name="' + value.node.name + '" data-product-brand="Chanel" data-product-price="' + value?.node?.prices?.salePrice + '" data-product-currency="USD">'
                        html += '<figure class="card-figure">'

                        html += '<div class="badge-wishlist-wrapper">'
                        html += '<a href="' + value.node.path + '" class="card-alt-img--hover card-image-normal" data-event-type="product-click">'
                        html += '<div class="card-img-container">'
                        html += '<span class="card-main-image"> <img class="card-image lazyautosizes ls-is-cached lazyloaded" data-sizes="auto" src="' + value.node.defaultImage.url + '" alt="' + value.node.name + '" title="' + value.node.name + '" sizes="339px"></span>'
                        html += '<span class="card-alt-image">  <img class="card-image lazyautosizes ls-is-cached lazyloaded" data-sizes="auto" src="' + value.node.defaultImage.url + '" alt="' + value.node.name + '" title="' + value.node.name + '" data-src="' + value.node.defaultImage.url + '" sizes="339px"></span>'
                        html += '</div>'
                        html += '</a>'
                        html += '<span class="product-wishlist" data-product-id="' + value.node.entityId + '">'
                        html += '<button aria-label="wishlist_' + value.node.entityId + '">'
                        html += '<i class="icon" aria-hidden="true">'
                        html += '<svg class="wishlist-solid" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 477.534 477.534" xml:space="preserve"><path fill="currentColor" d="M438.482,58.61c-24.7-26.549-59.311-41.655-95.573-41.711c-36.291,0.042-70.938,15.14-95.676,41.694l-8.431,8.909l-8.431-8.909C181.284,5.762,98.663,2.728,45.832,51.815c-2.341,2.176-4.602,4.436-6.778,6.778c-52.072,56.166-52.072,142.968,0,199.134l187.358,197.581c6.482,6.843,17.284,7.136,24.127,0.654.224-0.212,0.442-0.43,0.654-0.654l187.29-197.581C490.551,201.567,490.551,114.77,438.482,58.61z"></path></svg>'
                        html += '<svg class="wishlist-outline" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 477.534 477.534" xml:space="preserve"><path d="M438.482,58.61c-24.7-26.549-59.311-41.655-95.573-41.711c-36.291,0.042-70.938,15.14-95.676,41.694l-8.431,8.909l-8.431-8.909C181.284,5.762,98.662,2.728,45.832,51.815c-2.341,2.176-4.602,4.436-6.778,6.778c-52.072,56.166-52.072,142.968,0,199.134l187.358,197.581c6.482,6.843,17.284,7.136,24.127,0.654c0.224-0.212,0.442-0.43,0.654-0.654l187.29-197.581C490.551,201.567,490.551,114.77,438.482,58.61z M413.787,234.226h-0.017L238.802,418.768L63.818,234.226c-39.78-42.916-39.78-109.233,0-152.149c36.125-39.154,97.152-41.609,136.306-5.484c1.901,1.754,3.73,3.583,5.484,5.484l20.804,21.948c6.856,6.812,17.925,6.812,24.781,0l20.804-21.931c36.125-39.154,97.152-41.609,136.306-5.484c1.901,1.754,3.73,3.583,5.484,5.484C453.913,125.078,454.207,191.516,413.787,234.226z"></path></svg>'
                        html += '</i>'
                        html += '</button>'
                        html += '</span>'

                        html += '</div>'
                        html += '</figure>'
                        html += '<div class="card-body">'
                        html += '<div>'
                        html += '<a class="card-link" href="' + value.node.path + '" data-event-type="product-click">'
                        if (value?.node?.brand)
                            html += '<h3 class="card-text brand-name" data-test-info-type="brandName">' + value.node.brand.name + '</h3>'
                        html += '<h4 class="card-title">' + value.node.name + '</h4>'
                        html += '<div class="card-fields">'

                        html += '</div>'
                        if (custFileds) {
                            html += '<div class="card-fields">'
                            html += '<div class="custom-fields-list">'
                            html += '<span class="custom-field">' + custFileds + '</span>'
                            html += '</div>'
                            html += '</div>'
                        }

                        html += '<div class="card-text" data-test-info-type="price">'

                        html += '<div class="price-section price-section--withoutTax">'
                        html += '<div class="price-section price-section--withoutTax price--rrp rrp-price--withoutTax">'
                        if (value.node?.prices?.retailPrice != null)
                            html += '<span data-product-rrp-without-tax="" class="price price--rrp">Est. Retail&nbsp;<span class="currency-symbol"></span>' + currency + '' + value.node?.prices?.retailPrice?.value + '</span>'
                        html += '</div>'

                        html += '<div class="price price--listPrice">'

                        if (value.node.prices.salePrice != null)
                            html += '<span data-product-price-without-tax="" class="price price--withoutTax sale_price">' + currency + '' + value.node.prices.salePrice.value + '</span>'
                        else
                            html += '<span data-product-price-without-tax="" class="price price--withoutTax sale_price">' + currency + '' + value.node.prices.price.value + '</span>'

                        html += '</div>'

                        html += '</div>'

                        html += '</div>'
                        html += '<p class="view-link" data-miros-entry="custom" data-miros-item="' + allData[index].node.sku + '">View Similar</p> '
                        html += '</a>'
                        html += '</div>'
                        html += '</div>'
                        html += '<div class="card-figcaption-listing">'
                        html += '<a href="javascript:;" data-event-type="product-click" data-button-type="add-cart" data-product-name="{{name}}" data-product-price="{{price.without_tax.value}}" data-product-cat="{{category}}" data-product-img="' + value.node.defaultImage.url + '" data-product-id="{{id}}" class="button button--small card-figcaption-button custom-add-to-cart">Add to cart</a>'
                        html += '</div>'
                        html += '</article>'
                        html += '</div>'
                    }
                });

                // Append the new products to the existing list
                $(".productGridFavourite").append(html);

                // Handle pagination
                let pageInfo = data.data.site.route.node.products.pageInfo;
                if (pageInfo.hasNextPage) {
                    console.log("page to load");
                    // If there's a next page, load more products when the user scrolls to the bottom
                    $(window).off('scroll').on('scroll', function() {
                        if ($(window).scrollTop() + $(window).height() > $(document).height() - 1200) {
                            // Avoid multiple requests
                            $(window).off('scroll');
                            $('.page-load-status').show();
                            setTimeout(function(){
                                $('.page-load-status').hide();
                                youMayAlsoLike(pageInfo.endCursor);
                            }, 2000);
                            
                        }
                    });
                } else {
                    console.log("no page to load");
                    // No more pages to load
                    $(window).off('scroll');
                    $('.no-more-status').show();
                }
            }
        }
    });
}
function infiniteScroll() {
    //  console.log("fun call");
      if(document.querySelectorAll(".pagination-item--next .pagination-link").length > 0){
        //   console.log("next link found");
          if(document.querySelectorAll(".product-listing-show-products").length > 1){
              document.querySelectorAll(".product-listing-show-products")[0].style.display = "block";
              document.querySelectorAll(".product-listing-show-products")[1].style.display = "block";
          }
          const elem = document.querySelector('.productGrid');
     
          const infScroll = new InfiniteScroll(elem, {
          // options
              path: '.pagination-item--next .pagination-link',
              append: '.productGrid .product',
              history: false,
              //offset: 200,
              //button: '.view-more-button',
              // using button, disable loading on scroll 
              //scrollThreshold: false
              status: '.page-load-status',
          });
          
          return infScroll;
      }
  }

function getCurrencySymbol(currencyCode) {
    
    return (0).toLocaleString(undefined, {
        style: 'currency',
        currency: currencyCode,
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).replace(/\d/g, '').trim();
}
$(document).ready(function(){
            youMayAlsoLike();
        });
</script>
<input type="hidden" id="brandProductsCount" value="" />
<script>
 
let lastUrl = window.location.href;
new MutationObserver(() => {
const url = window.location.href;

if (url != lastUrl) {
    setTimeout(() => {
    
    if($('.productGrid li.product').length > 0 && $('.productGrid li.product') != null && $('.productGrid li.product').length != 48){
    lastUrl = url;
    $('.brand-product-count .product-totlecount b').text($('.productGrid li.product').length);
    $('.page-brand .product-totlecount b').text($('.productGrid li.product').length);
    
    if (isMobileView()) {
        if($(".inlineList.inlineList--labels li").length > 0)
        $(".selected-filters-count").text($(".inlineList.inlineList--labels li").length).addClass('selected');
    }
    }
    checkAndCallFunction(url);
    },1500);
}
}).observe(document, {subtree: true, childList: true});

setTimeout(() => {
let brand_url = "{{brand.url}}";
let url = window.location.href;
    
          let graphqlQuery = `query CategoryByUrl {
          site {
            route(path: "${brand_url}") {
              node {
                id
                ... on Brand {
                  name
                  entityId
                  products(hideOutOfStock: true) {
                   collectionInfo{
                    totalItems
                  }
                  }
                }
              }
            }
          }
        }`;

        const headers = {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer {{ settings.storefront_api.token }}'
        };

        // Make the AJAX POST request
        $.ajax({
            type: 'POST',
            url: '/graphql',
            headers: headers,
            data: JSON.stringify({ query: graphqlQuery }),
            dataType: 'json',
            success: function (data) {
          
                if (data.data.site.route.node != null && data.data.site.route.node.products.collectionInfo != null) {
                 let count = data.data.site.route.node.products.collectionInfo.totalItems;  
                 
                 $("#brandProductsCount").val(count);
                 if(brand_url == window.location.href || url.includes("?_bc_fsnf=1") && url.length > url.indexOf("?_bc_fsnf=1") + 11 == false){
                 $('.brand-product-count .product-totlecount b').text(count);
                    $('.page-brand .product-totlecount b').text(count);
                    
                    if (isMobileView()) {
                        if($(".inlineList.inlineList--labels li").length > 0)
                        $(".selected-filters-count").text(count).addClass('selected');
                    }
                }
                }
            },
        });
},1200);
        function isMobileView() {
            return $(window).width() < 820; // Adjust this breakpoint as needed
        }
        function checkAndCallFunction(url) {
          // Check if the URL contains "?_bc_fsnf=1" and has additional parameters
        
          if (url.includes("?_bc_fsnf=1") && url.length > url.indexOf("?_bc_fsnf=1") + 11 == false) {
     
            // Call your desired function here
            let count = $("#brandProductsCount").val();
             $('.brand-product-count .product-totlecount b').text(count);
                    $('.page-brand .product-totlecount b').text(count);
                    
                    if (isMobileView()) {
                        if($(".inlineList.inlineList--labels li").length > 0)
                        $(".selected-filters-count").text(count).addClass('selected');
                    }
          }
        }

        
</script>
{{/partial}}
{{> layout/base}}
